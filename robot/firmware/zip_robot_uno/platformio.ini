[env:uno]
; PINNED platform/toolchain to prevent binary drift between builds
platform = atmelavr@4.2.0
board = uno
framework = arduino
platform_packages =
    toolchain-atmelavr@3.70300.220127

; Serial monitor settings
monitor_speed = 115200
monitor_filters = default

; Build flags - AGGRESSIVE size optimization for UNO's 2KB RAM
; LTO + gc-sections critical for matching Arduino IDE size behavior
build_flags = 
    ; -DLED_USE_FASTLED  ; DISABLED - FastLED removed to fix build
    -Os                    ; Optimize for size
    -flto                  ; Link-time optimization (CRITICAL for RAM)
    -ffunction-sections    ; Enable dead code elimination
    -fdata-sections        ; Enable dead data elimination
    -Wl,--gc-sections      ; Linker: remove unused sections
    -Wall                  ; Enable warnings
    -Wl,-Map,firmware.map  ; Generate map file for RAM analysis

; Remove flags that bloat binary
build_unflags = 
    -O0                    ; Remove no-optimization
    -g                     ; Remove debug symbols
    -fno-lto               ; Ensure LTO is enabled

; Library dependencies (pinned versions for motion-first firmware)
; ArduinoJson REMOVED - replaced with lightweight fixed-field scanner (saves ~96+ bytes RAM)
lib_deps = 
    ; fastled/FastLED@^3.6.0  ; DISABLED - causes build issues and statusLED is disabled for RAM
    ; bblanchon/ArduinoJson@^6.21.3  ; REMOVED - using fixed-field scanner instead
    arduino-libraries/Servo@^1.3.0
    ; Note: IMU uses raw I2C (Wire library), no external library needed
    ; Note: IRremote (z3t0/IRremote) only if needed later - don't block motion MVP

; Upload settings (auto-detect if empty, or uncomment and set manually)
; upload_port = COM5
upload_speed = 115200

; Debug environment with additional debug flags
[env:uno_debug]
extends = env:uno
build_flags = 
    ${env:uno.build_flags}
    -DDEBUG=1
    -g
    -O0                    ; No optimization for debugging
build_unflags = 
    -Os                    ; Remove size optimization for debug

