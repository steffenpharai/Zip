; PlatformIO Project Configuration File
;
; ZIP ESP32-S3 Camera Firmware
; Board: ESP32S3-Camera-v1.0 (ELEGOO Smart Robot Car V4.0)
;
; Features:
; - WiFi AP with MAC-based SSID
; - MJPEG camera streaming on port 81
; - TCP server for robot commands on port 100
; - Serial2 bridge to Arduino UNO at 115200 baud
; - Health/diagnostics endpoint

[env:esp32cam]
platform = espressif32@6.5.0
board = esp32-s3-devkitc-1
framework = arduino

; ESP32-S3 settings
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_mode = qio
board_build.flash_freq = 80m

; CRITICAL: S3 camera boards use quad flash + octal PSRAM
; This setting is required for PSRAM to be detected
board_build.arduino.memory_type = qio_opi

; Partition scheme - Huge APP (3MB No OTA/1MB SPIFFS)
board_build.partitions = huge_app.csv

; Build flags
build_flags = 
    ; Hardware configuration
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    
    ; Core debug level (0=none, 1=error, 2=warn, 3=info, 4=debug, 5=verbose)
    -DCORE_DEBUG_LEVEL=1
    
    ; Feature flags (1=enabled, 0=disabled)
    -DENABLE_CAMERA=1
    -DENABLE_UART=1
    -DENABLE_STREAM=1
    -DENABLE_HEALTH_ENDPOINT=1
    -DENABLE_METRICS_ENDPOINT=0
    -DENABLE_VERBOSE_LOGS=0
    -DENABLE_SELF_TEST=0
    -DENABLE_UART_LOOPBACK=0
    
    ; Debug flags
    -DDEBUG_CAMERA_TIMING=0
    -DDEBUG_UART_FRAMES=0
    -DDEBUG_WIFI_EVENTS=0
    
    ; Include paths for modular structure
    -I include
    -I include/board
    -I include/config
    -I src
    -I src/drivers/camera
    -I src/drivers/uart
    -I src/net
    -I src/web

; Source files - use modular app_main instead of legacy main.cpp
build_src_filter = 
    +<app/>
    +<drivers/>
    +<net/>
    +<web/>
    -<main.cpp>

; Monitor configuration - USB CDC on ESP32-S3
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Upload configuration
upload_speed = 460800
upload_flags = 
    --before=default_reset
    --after=hard_reset
    --chip=esp32s3

; No external library dependencies - all built into ESP32 framework
lib_deps = 

; ============================================================================
; Alternative build environments
; ============================================================================

; Debug build with verbose logging and self-test
[env:esp32cam_debug]
extends = env:esp32cam
build_flags = 
    ${env:esp32cam.build_flags}
    -DENABLE_VERBOSE_LOGS=1
    -DENABLE_SELF_TEST=1
    -DDEBUG_UART_FRAMES=1
    -DCORE_DEBUG_LEVEL=3

; Minimal build without camera (for testing UART bridge only)
[env:esp32cam_minimal]
extends = env:esp32cam
build_flags = 
    ${env:esp32cam.build_flags}
    -DENABLE_CAMERA=0
    -DENABLE_STREAM=0
